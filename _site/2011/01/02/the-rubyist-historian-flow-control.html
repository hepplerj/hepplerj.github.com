<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta content="The online writing of Jason Heppler" name="description"/>
<title>The Rubyist Historian: Loops and Control Structures</title> <meta name="author" content="Jason Heppler" />
<link rel="stylesheet" href="/css/syntax.css" type="text/css" />
<link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="/css/tweet.css" type="text/css" />
<link href="/webfonts/ss-social.css" rel="stylesheet" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="http://jasonheppler.org/js/styleTweets.js"></script>

<link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

<script src="http://d3js.org/d3.v3.min.js"></script>

<style>

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.bar {
  fill: steelblue;
}

.x.axis path {
  display: none;
}

svg {
  font: 13px sans-serif;
}

</style>

   <script type="text/javascript">

     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-12786552-1']);
     _gaq.push(['_trackPageview']);

     (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();

   </script>

</head>
<body>

<div class="header">
	<div class="header_container">

		<section class="name"><a href="/">Jason Heppler</a></section>
		<ul class="menu">
			<li><a href="/about.html">Colophon</a></li>
			<li><a href="/research.html">Research</a></li>
			<li><a href="/teaching.html">Teaching</a></li>
			<li><a href="/hacks.html">Digital &amp; Public History</a></li>
			<li><a href="http://jasonheppler.org/jah-vita.pdf">Vita</a></li>
		</ul>
	</div>
</div>

<section class="container content">

<aside><p class="when">January  2, 2011</p></aside>
<h1>The Rubyist Historian: Loops and Control Structures</h1>

<p>Our last segment introduced us to Ruby methods and classes.  This section will introduce you to expressions and loops. Loops are, put simply, a test of whether an expression is true or false. This is the basic way that computer&#8217;s operate: continue following a set of instructions until the expression becomes true, then end or move on to the next set of instructions.<!--more--></p>

<h4>while . . . end</h4>

<p>Let&#8217;s say we needed a program that printed numbers until it reached five.  In this case, we want the program to print a number, evaluate whether that number is equal to five, if not add one and run the program again.  Once the number is equal to five, the program terminates.  We achieve this through the use of the <code>while . . . end</code> loop:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">while</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">5</span>
    <span class="nb">puts</span> <span class="n">num</span>
    <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">end</span>
</code></pre></div>

<p>Running <code>ruby loop.rb</code> in the terminal will produce:</p>

<div class="highlight"><pre><code class="console"><span class="go">0</span>
<span class="go">1</span>
<span class="go">2</span>
<span class="go">3</span>
<span class="go">4</span>
</code></pre></div>

<p>Note the <code>+=</code> above. This symbol is called an <strong>operator</strong>, which allow us to compare values.  </p>

<p><strong>Example Operators</strong>
&lt;table border="0" width="100%" cellpadding="3" cellspacing="3"&gt;
	&lt;tr&gt;
		&lt;td&gt;==&lt;/td&gt;
		&lt;td&gt;Test for equal value.&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td width="20%"&gt;&lt;, &lt;=, &gt;=, &gt;&lt;/td&gt;
		&lt;td&gt;Comparison operator for less than, less than or equal, greater than or equal, and grater than&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td&gt;&lt;=&gt;&lt;/td&gt;
		&lt;td&gt;Returns -1, 0, or +1 depending on whether the receiver is less than, equal to, or greater than its argument.&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td&gt;-=&lt;/td&gt;
		&lt;td&gt;Subtraction operator.&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td&gt;*=&lt;/td&gt;
		&lt;td&gt;Multiplication operator.&lt;/td&gt;
	&lt;/tr&gt;
        &lt;tr&gt;
		&lt;td&gt;!=&lt;/td&gt;
		&lt;td&gt;Not equal to operator.&lt;/td&gt;
	&lt;/tr&gt;
&lt;/table&gt;</p>

<h4>if . . . elsif . . . else</h4>

<p>The <code>if . . . else</code> loop allows us to evaluate several branches of code in the order we write it.  If the first branch is false, the program moves on to the next and the next and so on until the value is true and terminates the program.  We could write a program that evaluates what a user thinks about the quality of a book, for example:</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">puts</span> <span class="s2">&quot;Enter a rating between one and five: &quot;</span>

<span class="c1"># we use .to_i to convert the string to an integer</span>
<span class="n">rank</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span><span class="o">.</span><span class="n">to_i</span>

<span class="k">if</span> <span class="n">rank</span> <span class="o">&gt;=</span> <span class="mi">4</span>
    <span class="nb">puts</span> <span class="s2">&quot;The book was good!&quot;</span>
<span class="k">elsif</span> <span class="n">rank</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="nb">puts</span> <span class="s2">&quot;The book was so-so.&quot;</span>
<span class="k">elsif</span> <span class="n">rank</span> <span class="o">&lt;=</span> <span class="mi">2</span>
    <span class="nb">puts</span> <span class="s2">&quot;The book stinks.&quot;</span>
<span class="k">end</span>
</code></pre></div>

<p>Pro Tip: If you get stuck in a loop and the terminal won&#8217;t quit printing to the screen, hit CTRL+C.  CTRL+C tells the terminal to stop whatever it&#8217;s working on.</p>

<h4>Iterators</h4>

<p>So far we&#8217;ve looked at some pretty primitive versions of loop constructs.  Unlike Java, C, and C++, Ruby doesn&#8217;t have a <code>for</code> loop.  Instead, it uses a less error-prone, built-in class functionality called <strong>iterators</strong>.  Let&#8217;s say you just finished writing a section of a chapter and wanted some applause for your effort.  We could write a program to do that for you:</p>

<div class="highlight"><pre><code class="ruby"><span class="mi">3</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span> 
   <span class="nb">print</span> <span class="s2">&quot;Clap! &quot;</span>
<span class="k">end</span>
</code></pre></div>

<p>Run the program from the terminal and it will produce:</p>

<div class="highlight"><pre><code class="console"><span class="go">Clap! Clap! Clap!</span>
</code></pre></div>

<p>There, now you and your computer just shared a special moment.  A pretty simple block of code, right? You could read what the program is doing even if you didn&#8217;t understand a single line of Ruby: print &#8220;Clap!&#8221; three times, no more, no less.  Simplicity.</p>

<p>We can also use iterators to loop through ranges.  Let&#8217;s return to our number counter example above and write an iterator to print numbers between one and five:</p>

<div class="highlight"><pre><code class="ruby"><span class="mi">0</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
    <span class="nb">print</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot; &quot;</span>
<span class="k">end</span>
</code></pre></div>

<p>The most basic iterator in Ruby is simply <code>loop</code>, which will run the block forever until you break out of the loop:</p>

<div class="highlight"><pre><code class="ruby"><span class="kp">loop</span> <span class="k">do</span>
    <span class="nb">print</span> <span class="s2">&quot;85098357-198058903028340jj23u0280234itj3&quot;</span>
    <span class="c1"># it&#39;s just like the Matrix!</span>
<span class="k">end</span>
</code></pre></div>

<p>Hit CTRL+C to break the loop.</p>

<h4>Blocks</h4>

<p>Blocks contains a chunk of code normally enclosed between braces or within <code>do</code> and <code>end</code>.  The prevailing style is to use the braces for blocks that fit on a single line and <code>do . . . end</code> for multiple lines. Blocks are called only after the invocation of some method.  We could, for example, write a program that sums the squares of numbers inside of an array:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>

<span class="o">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">value</span><span class="o">|</span>
    <span class="n">square</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">value</span>
    <span class="n">sum</span> <span class="o">+=</span> <span class="n">square</span>
<span class="k">end</span> 

<span class="nb">puts</span> <span class="n">sum</span>
</code></pre></div>

<p>In this example, the block is being called by the <code>each</code> method once for each element in the array.  The element passed as the parameter is <code>value</code>.  Note also that although <code>sum</code> is defined outside of the block, it is also being modified within the block and then passed on to <code>puts</code>.  If a variable is inside a block with the same name as a variable outside of the block the two are the same, but if a variable appears only inside a block than the variable is local to the block.</p>

<p>As extra reading, I would check out Steve Ramsay&#8217;s <a href="http://etext.lib.virginia.edu/services/helpsheets/unix/regex.html">guide to regular expressions</a>. I won&#8217;t be covering regular expressions, but they will eventually show up and be useful as part of your programmer toolkit. It&#8217;s good to get familiar with them.</p>

<h4>Additional Resources</h4>
<ul>
<li><a href="http://www.skorks.com/2009/09/a-wealth-of-ruby-loops-and-iterators/">A Wealth of Ruby Loops and Iterators</a>, Shorks</li>
<li><a href="http://www.rubyist.net/~slagell/ruby/control.html">Control Structures</a>, Rubyist</li>
</ul>

<p><em>Visit the Rubyist Historian <a href="http://www.jasonheppler.org/the-rubyist-historian-the-series.html">Table of Contents</a> for more sections, and check out the <a href="https://github.com/hepplerj/rubyist-historian">Github repository</a> for an archive of all the code examples.</em></p>

<p><em>See something that&#8217;s wrong?  Examples that don&#8217;t work?  Explanations that are unclear or confusing?  Embarrassing typographic errors?  Drop me an email at jason.heppler+feedback at gmail and I&#8217;ll fix things right up!</em></p>

<p><em>Topic structure, examples, and explanations for the Rubyist Historian are inspired by, credited to, and drawn from Stephen Ramsay and his course Electronic Text.</em></p>

<p><strong>UPDATE 2012-12-21</strong>: Thanks to Brooke Lester for pointing out a typo in the final code example. The problem has been corrected.</p>


<section class="post_meta">
  <div class="block">
    <a href="http://twitter.com/jaheppler">
      <span class="ss-twitter ss-social-circle">
        <div>Follow me on Twitter.</div>
      </span>
    </a>
  </div>
  
  <div class="block">
  	<a href="http://acomp.stanford.edu/faculty/atsp">
  		<span class="ss-like ss-social-circle">
  			<div>I am the Academic Technology Specialist in the History Department at Stanford University.</div>
  		</span>
  	</a>
  </div>

  <div class="block">
  	<a href="http://github.com/hepplerj">
  		<span class="ss-github ss-social-circle">
  			<div>Follow me on Github.</div>
  		</span>
  	</a>
  </div>
</section>


</section>

<footer>
	Tech, history, code, coffee • Written by <a href="http://jasonheppler.org/about.html">Jason Heppler</a> • Powered by <a href="http://github.com/mojombo/jekyll">Jekyll</a> <br/> Licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC-BY</a> • <a href="http://www.jasonheppler.org/feed.xml">Subscribe to RSS</a>

<br>

Remember <a href="http://lessig.tumblr.com/post/40347463044/prosecutor-as-bully">Aaron Swartz</a>

</footer>

</body>
</html>
